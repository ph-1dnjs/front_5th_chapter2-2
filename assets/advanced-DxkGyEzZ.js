import{j as e,r as y,c as E,R as F}from"./client-BW4HFQ8H.js";const M=({product:t,remainingStock:s,getMaxDiscount:n,addToCart:a})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(n(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((o,d)=>e.jsxs("li",{children:[o.quantity,"개 이상: ",(o.rate*100).toFixed(0),"% 할인"]},d))}),e.jsx("button",{onClick:()=>a(t),className:`w-full px-3 py-1 rounded ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]}),$=({products:t,getRemainingStock:s,getMaxDiscount:n,addToCart:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(o=>e.jsx(M,{product:o,remainingStock:s(o),getMaxDiscount:n,addToCart:a},o.id))})]}),L=({totalBeforeDiscount:t,totalDiscount:s,totalAfterDiscount:n})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",t.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})]}),R=({item:t,updateQuantity:s,removeFromCart:n})=>e.jsxs("div",{children:[e.jsx("button",{onClick:()=>s(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>s(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>n(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]}),U=({item:t,appliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,s>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsx(R,{item:t,updateQuantity:n,removeFromCart:a})]}),B=({cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsx("div",{className:"space-y-2",children:t.map(o=>{const d=s(o);return e.jsx(U,{item:o,appliedDiscount:d,updateQuantity:n,removeFromCart:a},o.product.id)})}),O=({cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(B,{cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})]}),Q=({selectedCoupon:t})=>{if(!t)return null;const s=t.discountType==="amount"?`${t.discountValue.toLocaleString()}원`:`${t.discountValue}%`;return e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",s," 할인)"]})},J=({coupons:t,onSelect:s})=>{const n=a=>{const o=parseInt(a.target.value);isNaN(o)||s(t[o])};return e.jsxs("select",{onChange:n,className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((a,o)=>e.jsxs("option",{value:o,children:[a.name," -"," ",a.discountType==="amount"?`${a.discountValue.toLocaleString()}원`:`${a.discountValue}%`]},a.code))]})};function W({coupons:t,selectedCoupon:s,applyCoupon:n}){return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(J,{coupons:t,onSelect:n}),e.jsx(Q,{selectedCoupon:s})]})}const _=({newProduct:t,onChange:s,onAdd:n})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:a=>s({...t,name:a.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:a=>s({...t,price:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:a=>s({...t,stock:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),z=({showNewProductForm:t,toggleShowNewProductForm:s,newProduct:n,onChange:a,onAdd:o})=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:t?"취소":"새 상품 추가"}),t&&e.jsx(_,{newProduct:n,onChange:a,onAdd:o})]}),G=({newDiscount:t,onChange:s,onAdd:n})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:t.quantity,onChange:a=>s({...t,quantity:parseInt(a.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:t.rate*100,onChange:a=>s({...t,rate:parseInt(a.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:n,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]}),H=({product:t,editingProduct:s,newDiscount:n,onUpdateName:a,onUpdatePrice:o,onUpdateStock:d,onAddDiscount:l,onRemoveDiscount:r,onDiscountChange:p,onEditComplete:f})=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:s.name,onChange:c=>a(t.id,c.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:s.price,onChange:c=>o(t.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:s.stock,onChange:c=>d(t.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),s.discounts.map((c,u)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>r(t.id,u),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},u)),e.jsx(G,{newDiscount:n,onChange:p,onAdd:()=>l(t.id)})]}),e.jsx("button",{onClick:f,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}),K=({products:t,openProductIds:s,editingProduct:n,newDiscount:a,toggleProductAccordion:o,handleEditProduct:d,handleProductNameUpdate:l,handlePriceUpdate:r,handleStockUpdate:p,handleAddDiscount:f,handleRemoveDiscount:c,handleEditComplete:u,setNewDiscount:x})=>e.jsx("div",{className:"space-y-2",children:t.map((h,b)=>e.jsxs("div",{"data-testid":`product-${b+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>o(h.id),className:"w-full text-left font-semibold",children:[h.name," - ",h.price,"원 (재고: ",h.stock,")"]}),s.has(h.id)&&e.jsx("div",{className:"mt-2",children:n&&n.id===h.id?e.jsx(H,{product:h,editingProduct:n,newDiscount:a,onUpdateName:l,onUpdatePrice:r,onUpdateStock:p,onAddDiscount:f,onRemoveDiscount:c,onDiscountChange:x,onEditComplete:u}):e.jsxs("div",{children:[h.discounts.map((j,N)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[j.quantity,"개 이상 구매 시 ",j.rate*100,"% 할인"]})},N)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>d(h),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},h.id))}),X=({newCoupon:t,setNewCoupon:s,handleAddCoupon:n})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:a=>s({...t,name:a.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:a=>s({...t,code:a.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:a=>s({...t,discountType:a.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:a=>s({...t,discountValue:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),Y=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((s,n)=>e.jsxs("div",{"data-testid":`coupon-${n+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]},n))})]}),Z=({newCoupon:t,setNewCoupon:s,handleAddCoupon:n,coupons:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(X,{newCoupon:t,setNewCoupon:s,handleAddCoupon:n}),e.jsx(Y,{coupons:a})]})]}),ee=t=>{const{price:s}=t.product,{quantity:n}=t,a=t.product.discounts.reduce((o,d)=>n>=d.quantity&&d.rate>o?d.rate:o,0);return s*n*(1-a)},te=(t,s)=>{let n=0,a=0;t.forEach(d=>{const l=ee(d);n+=d.product.price*d.quantity,a+=l});let o=n-a;return s&&(s.discountType==="amount"?a=Math.max(0,a-s.discountValue):a*=1-s.discountValue/100,o=n-a),{totalBeforeDiscount:Math.round(n),totalAfterDiscount:Math.round(a),totalDiscount:Math.round(o)}},se=(t,s,n)=>t.map(o=>{if(o.product.id===s){const d=o.product.stock,l=Math.max(0,Math.min(n,d));return l>0?{...o,quantity:l}:null}return o}).filter(o=>o!==null);function ne(t,s){const[n,a]=y.useState(()=>{try{const o=window.localStorage.getItem(t);return o?JSON.parse(o):s}catch(o){return console.warn(`Error reading localStorage key “${t}”:`,o),s}});return y.useEffect(()=>{try{const o=JSON.stringify(n);window.localStorage.setItem(t,o)}catch(o){console.warn(`Error setting localStorage key “${t}”:`,o)}},[t,n]),[n,a]}const ae=()=>{const[t,s]=ne("cart",[]),[n,a]=y.useState(null),o=c=>{f(c)<=0||s(x=>x.find(b=>b.product.id===c.id)?x.map(b=>b.product.id===c.id?{...b,quantity:Math.min(b.quantity+1,c.stock)}:b):[...x,{product:c,quantity:1}])},d=c=>{s(u=>u.filter(x=>x.product.id!==c))},l=(c,u)=>{s(x=>se(x,c,u))},r=c=>{a(c)},p=()=>te(t,n),f=c=>{const u=t.find(x=>x.product.id===c.id);return c.stock-((u==null?void 0:u.quantity)||0)};return{cart:t,addToCart:o,removeFromCart:d,updateQuantity:l,applyCoupon:r,calculateTotal:p,selectedCoupon:n}},oe=t=>{const[s,n]=y.useState(t);return{coupons:s,addCoupon:o=>{n(d=>[...d,o])}}},de=t=>{const[s,n]=y.useState(t);return{products:s,updateProduct:d=>{n(l=>l.map(r=>r.id===d.id?d:r))},addProduct:d=>{n(l=>[...l,d])}}},ce=({products:t,coupons:s})=>{const{cart:n,addToCart:a,removeFromCart:o,updateQuantity:d,applyCoupon:l,calculateTotal:r,selectedCoupon:p}=ae(),f=j=>j.reduce((N,w)=>Math.max(N,w.rate),0),c=j=>{const N=n.find(w=>w.product.id===j.id);return j.stock-((N==null?void 0:N.quantity)||0)},{totalBeforeDiscount:u,totalAfterDiscount:x,totalDiscount:h}=r(),b=j=>{const{discounts:N}=j.product,{quantity:w}=j;let C=0;for(const S of N)w>=S.quantity&&(C=Math.max(C,S.rate));return C};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx($,{products:t,getRemainingStock:c,getMaxDiscount:f,addToCart:a}),e.jsxs("div",{children:[e.jsx(O,{cart:n,getAppliedDiscount:b,updateQuantity:d,removeFromCart:o}),e.jsx(W,{coupons:s,applyCoupon:l,selectedCoupon:p}),e.jsx(L,{totalDiscount:h,totalBeforeDiscount:u,totalAfterDiscount:x})]})]})]})},re=({products:t,coupons:s,onProductUpdate:n,onProductAdd:a,onCouponAdd:o})=>{const[d,l]=y.useState(new Set),[r,p]=y.useState(null),[f,c]=y.useState({quantity:0,rate:0}),[u,x]=y.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[h,b]=y.useState(!1),[j,N]=y.useState({name:"",price:0,stock:0,discounts:[]}),w=m=>{l(g=>{const i=new Set(g);return i.has(m)?i.delete(m):i.add(m),i})},C=m=>{p({...m})},S=(m,g)=>{if(r&&r.id===m){const i={...r,name:g};p(i)}},k=(m,g)=>{if(r&&r.id===m){const i={...r,price:g};p(i)}},P=()=>{r&&(n(r),p(null))},q=(m,g)=>{const i=t.find(v=>v.id===m);if(i){const v={...i,stock:g};n(v),p(v)}},A=m=>{const g=t.find(i=>i.id===m);if(g&&r){const i={...g,discounts:[...g.discounts,f]};n(i),p(i),c({quantity:0,rate:0})}},T=(m,g)=>{const i=t.find(v=>v.id===m);if(i){const v={...i,discounts:i.discounts.filter((me,V)=>V!==g)};n(v),p(v)}},I=()=>{o(u),x({name:"",code:"",discountType:"percentage",discountValue:0})},D=()=>{const m={...j,id:Date.now().toString()};a(m),N({name:"",price:0,stock:0,discounts:[]}),b(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(z,{showNewProductForm:h,toggleShowNewProductForm:()=>b(!h),newProduct:j,onChange:N,onAdd:D}),e.jsx(K,{products:t,openProductIds:d,editingProduct:r,newDiscount:f,toggleProductAccordion:w,handleEditProduct:C,handleProductNameUpdate:S,handlePriceUpdate:k,handleStockUpdate:q,handleAddDiscount:A,handleRemoveDiscount:T,handleEditComplete:P,setNewDiscount:c})]}),e.jsx(Z,{newCoupon:u,setNewCoupon:x,handleAddCoupon:I,coupons:s})]})]})},le=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ie=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],ue=()=>{const{products:t,updateProduct:s,addProduct:n}=de(le),{coupons:a,addCoupon:o}=oe(ie),[d,l]=y.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>l(!d),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:d?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:d?e.jsx(re,{products:t,coupons:a,onProductUpdate:s,onProductAdd:n,onCouponAdd:o}):e.jsx(ce,{products:t,coupons:a})})]})};E.createRoot(document.getElementById("root")).render(e.jsx(F.StrictMode,{children:e.jsx(ue,{})}));
