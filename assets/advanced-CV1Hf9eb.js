import{j as e,r as N,c as $,R as M}from"./client-BW4HFQ8H.js";const F=({product:t,remainingStock:s,getMaxDiscount:n,addToCart:a})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(n(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((r,o)=>e.jsxs("li",{children:[r.quantity,"개 이상: ",(r.rate*100).toFixed(0),"% 할인"]},o))}),e.jsx("button",{onClick:()=>a(t),className:`w-full px-3 py-1 rounded ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]}),L=({products:t,getRemainingStock:s,getMaxDiscount:n,addToCart:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(r=>e.jsx(F,{product:r,remainingStock:s(r),getMaxDiscount:n,addToCart:a},r.id))})]}),R=({totalBeforeDiscount:t,totalDiscount:s,totalAfterDiscount:n})=>e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",t.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",n.toLocaleString(),"원"]})]})]}),U=({item:t,updateQuantity:s,removeFromCart:n})=>e.jsxs("div",{children:[e.jsx("button",{onClick:()=>s(t.product.id,t.quantity-1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:()=>s(t.product.id,t.quantity+1),className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:()=>n(t.product.id),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]}),B=({item:t,appliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,s>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(s*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsx(U,{item:t,updateQuantity:n,removeFromCart:a})]}),O=({cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsx("div",{className:"space-y-2",children:t.map(r=>{const o=s(r);return e.jsx(B,{item:r,appliedDiscount:o,updateQuantity:n,removeFromCart:a},r.product.id)})}),Q=({cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"장바구니 내역"}),e.jsx(O,{cart:t,getAppliedDiscount:s,updateQuantity:n,removeFromCart:a})]}),J=({selectedCoupon:t})=>{if(!t)return null;const s=t.discountType==="amount"?`${t.discountValue.toLocaleString()}원`:`${t.discountValue}%`;return e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",t.name,"(",s," 할인)"]})},W=({coupons:t,onSelect:s})=>{const n=a=>{const r=parseInt(a.target.value);isNaN(r)||s(t[r])};return e.jsxs("select",{onChange:n,className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((a,r)=>e.jsxs("option",{value:r,children:[a.name," -"," ",a.discountType==="amount"?`${a.discountValue.toLocaleString()}원`:`${a.discountValue}%`]},a.code))]})};function _({coupons:t,selectedCoupon:s,applyCoupon:n}){return e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsx(W,{coupons:t,onSelect:n}),e.jsx(J,{selectedCoupon:s})]})}const z=({newProduct:t,onChange:s,onAdd:n})=>e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:t.name,onChange:a=>s({...t,name:a.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:t.price,onChange:a=>s({...t,price:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:t.stock,onChange:a=>s({...t,stock:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),G=({showNewProductForm:t,toggleShowNewProductForm:s,newProduct:n,onChange:a,onAdd:r})=>e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:s,className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:t?"취소":"새 상품 추가"}),t&&e.jsx(z,{newProduct:n,onChange:a,onAdd:r})]}),H=({newDiscount:t,onChange:s,onAdd:n})=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:t.quantity,onChange:a=>s({...t,quantity:parseInt(a.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:t.rate*100,onChange:a=>s({...t,rate:parseInt(a.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:n,className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]}),K=({product:t,editingProduct:s,newDiscount:n,onUpdateName:a,onUpdatePrice:r,onUpdateStock:o,onAddDiscount:l,onRemoveDiscount:d,onDiscountChange:b,onEditComplete:f})=>e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:s.name,onChange:c=>a(t.id,c.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:s.price,onChange:c=>r(t.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:s.stock,onChange:c=>o(t.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),s.discounts.map((c,m)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>d(t.id,m),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},m)),e.jsx(H,{newDiscount:n,onChange:b,onAdd:()=>l(t.id)})]}),e.jsx("button",{onClick:f,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}),X=({products:t,openProductIds:s,editingProduct:n,newDiscount:a,toggleProductAccordion:r,handleEditProduct:o,handleProductNameUpdate:l,handlePriceUpdate:d,handleStockUpdate:b,handleAddDiscount:f,handleRemoveDiscount:c,handleEditComplete:m,setNewDiscount:h})=>e.jsx("div",{className:"space-y-2",children:t.map((p,u)=>e.jsxs("div",{"data-testid":`product-${u+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>r(p.id),className:"w-full text-left font-semibold",children:[p.name," - ",p.price,"원 (재고: ",p.stock,")"]}),s.has(p.id)&&e.jsx("div",{className:"mt-2",children:n&&n.id===p.id?e.jsx(K,{product:p,editingProduct:n,newDiscount:a,onUpdateName:l,onUpdatePrice:d,onUpdateStock:b,onAddDiscount:f,onRemoveDiscount:c,onDiscountChange:h,onEditComplete:m}):e.jsxs("div",{children:[p.discounts.map((g,y)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[g.quantity,"개 이상 구매 시 ",g.rate*100,"% 할인"]})},y)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>o(p),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},p.id))}),Y=({newCoupon:t,setNewCoupon:s,handleAddCoupon:n})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:a=>s({...t,name:a.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:a=>s({...t,code:a.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:a=>s({...t,discountType:a.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:t.discountValue,onChange:a=>s({...t,discountValue:parseInt(a.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:n,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),Z=({coupons:t})=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:t.map((s,n)=>e.jsxs("div",{"data-testid":`coupon-${n+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]},n))})]}),ee=({newCoupon:t,setNewCoupon:s,handleAddCoupon:n,coupons:a})=>e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsx(Y,{newCoupon:t,setNewCoupon:s,handleAddCoupon:n}),e.jsx(Z,{coupons:a})]})]}),te=t=>{const{price:s}=t.product,{quantity:n}=t,a=t.product.discounts.reduce((r,o)=>n>=o.quantity&&o.rate>r?o.rate:r,0);return s*n*(1-a)},S=(t,s)=>{let n=0,a=0;t.forEach(o=>{const l=te(o);n+=o.product.price*o.quantity,a+=l});let r=n-a;return s&&(s.discountType==="amount"?a=Math.max(0,a-s.discountValue):a*=1-s.discountValue/100,r=n-a),{totalBeforeDiscount:Math.round(n),totalAfterDiscount:Math.round(a),totalDiscount:Math.round(r)}},se=(t,s,n)=>t.map(r=>{if(r.product.id===s){const o=r.product.stock,l=Math.max(0,Math.min(n,o));return l>0?{...r,quantity:l}:null}return r}).filter(r=>r!==null);function ne(t,s){const[n,a]=N.useState(()=>{try{const r=window.localStorage.getItem(t);return r?JSON.parse(r):s}catch(r){return console.warn(`Error reading localStorage key “${t}”:`,r),s}});return N.useEffect(()=>{try{const r=JSON.stringify(n);window.localStorage.setItem(t,r)}catch(r){console.warn(`Error setting localStorage key “${t}”:`,r)}},[t,n]),[n,a]}const ae=()=>{const[t,s]=ne("cart",[]),[n,a]=N.useState(null),r=c=>{f(c)<=0||s(h=>h.find(u=>u.product.id===c.id)?h.map(u=>u.product.id===c.id?{...u,quantity:Math.min(u.quantity+1,c.stock)}:u):[...h,{product:c,quantity:1}])},o=c=>{s(m=>m.filter(h=>h.product.id!==c))},l=(c,m)=>{s(h=>se(h,c,m))},d=c=>{a(c)},b=()=>S(t,n),f=c=>{const m=t.find(h=>h.product.id===c.id);return c.stock-((m==null?void 0:m.quantity)||0)};return{cart:t,addToCart:r,removeFromCart:o,updateQuantity:l,applyCoupon:d,calculateTotal:b,selectedCoupon:n}},re=t=>{const[s,n]=N.useState(t);return{coupons:s,addCoupon:r=>{n(o=>[...o,r])}}},oe=t=>{const[s,n]=N.useState(t);return{products:s,updateProduct:o=>{n(l=>l.map(d=>d.id===o.id?o:d))},addProduct:o=>{n(l=>[...l,o])}}},ce=(t,s)=>N.useMemo(()=>S(t,s),[t,s]),de=({products:t,coupons:s})=>{const{cart:n,addToCart:a,removeFromCart:r,updateQuantity:o,applyCoupon:l,selectedCoupon:d}=ae(),b=u=>u.reduce((g,y)=>Math.max(g,y.rate),0),f=u=>{const g=n.find(y=>y.product.id===u.id);return u.stock-((g==null?void 0:g.quantity)||0)},{totalBeforeDiscount:c,totalAfterDiscount:m,totalDiscount:h}=ce(n,d),p=u=>{const{discounts:g}=u.product,{quantity:y}=u;let w=0;for(const C of g)y>=C.quantity&&(w=Math.max(w,C.rate));return w};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(L,{products:t,getRemainingStock:f,getMaxDiscount:b,addToCart:a}),e.jsxs("div",{children:[e.jsx(Q,{cart:n,getAppliedDiscount:p,updateQuantity:o,removeFromCart:r}),e.jsx(_,{coupons:s,applyCoupon:l,selectedCoupon:d}),e.jsx(R,{totalDiscount:h,totalBeforeDiscount:c,totalAfterDiscount:m})]})]})]})},le=t=>{const s=[];return(!t.name||t.name.trim()==="")&&s.push("상품 이름은 필수입니다."),t.price<=0&&s.push("상품 가격은 0보다 커야 합니다."),t.stock<0&&s.push("상품 재고는 음수일 수 없습니다."),t.discounts.forEach((n,a)=>{n.quantity<=0&&s.push(`할인 ${a+1}: 할인 수량은 1 이상이어야 합니다.`),(n.rate<0||n.rate>1)&&s.push(`할인 ${a+1}: 할인율은 0 이상 1 이하이어야 합니다.`)}),s},ie=({products:t,coupons:s,onProductUpdate:n,onProductAdd:a,onCouponAdd:r})=>{const[o,l]=N.useState(new Set),[d,b]=N.useState(null),[f,c]=N.useState({quantity:0,rate:0}),[m,h]=N.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[p,u]=N.useState(!1),[g,y]=N.useState({name:"",price:0,stock:0,discounts:[]}),w=x=>{l(j=>{const i=new Set(j);return i.has(x)?i.delete(x):i.add(x),i})},C=x=>{b({...x})},k=(x,j)=>{if(d&&d.id===x){const i={...d,name:j};b(i)}},P=(x,j)=>{if(d&&d.id===x){const i={...d,price:j};b(i)}},q=()=>{d&&(n(d),b(null))},A=(x,j)=>{const i=t.find(v=>v.id===x);if(i){const v={...i,stock:j};n(v),b(v)}},T=x=>{const j=t.find(i=>i.id===x);if(j&&d){const i={...j,discounts:[...j.discounts,f]};n(i),b(i),c({quantity:0,rate:0})}},D=(x,j)=>{const i=t.find(v=>v.id===x);if(i){const v={...i,discounts:i.discounts.filter((he,V)=>V!==j)};n(v),b(v)}},I=()=>{r(m),h({name:"",code:"",discountType:"percentage",discountValue:0})},E=()=>{const x={...g,id:Date.now().toString()};if(le(x).length>0){alert("상품 추가 오류: errors");return}a(x),y({name:"",price:0,stock:0,discounts:[]}),u(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx(G,{showNewProductForm:p,toggleShowNewProductForm:()=>u(!p),newProduct:g,onChange:y,onAdd:E}),e.jsx(X,{products:t,openProductIds:o,editingProduct:d,newDiscount:f,toggleProductAccordion:w,handleEditProduct:C,handleProductNameUpdate:k,handlePriceUpdate:P,handleStockUpdate:A,handleAddDiscount:T,handleRemoveDiscount:D,handleEditComplete:q,setNewDiscount:c})]}),e.jsx(ee,{newCoupon:m,setNewCoupon:h,handleAddCoupon:I,coupons:s})]})]})},ue=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],me=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],xe=()=>{const{products:t,updateProduct:s,addProduct:n}=oe(ue),{coupons:a,addCoupon:r}=re(me),[o,l]=N.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>l(!o),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:o?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:o?e.jsx(ie,{products:t,coupons:a,onProductUpdate:s,onProductAdd:n,onCouponAdd:r}):e.jsx(de,{products:t,coupons:a})})]})};$.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(xe,{})}));
